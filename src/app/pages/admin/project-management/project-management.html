<!-- project-management.html -->
<!-- Tabs Navigation -->
<div class="flex border-b border-gray-200 mb-6 justify-center">
    <div class="flex">
        <button 
            (click)="setActiveTab('projects')" 
            [class]="'tab-button px-4 py-2 text-md font-medium ' + (activeTab === 'projects' ? 'active' : '')"
        >
            <fa-icon [icon]="faProjectDiagram" class="mr-2"></fa-icon> Projects
        </button>
        <button 
            (click)="setActiveTab('sprints')" 
            [class]="'tab-button px-4 py-2 text-md font-medium ' + (activeTab === 'sprints' ? 'active' : '')"
        >
            <fa-icon [icon]="faTasks" class="mr-2"></fa-icon> Sprints
        </button>
    </div>
</div>

<!-- Projects Tab Content -->
<div *ngIf="activeTab === 'projects'" class="tab-content active">
    <!-- Search, Filter and Add Project -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4"> 
        <div class="relative w-full md:w-64">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <fa-icon [icon]="faSearch" class="text-gray-400 text-sm"></fa-icon>
            </div>
            <input 
                type="text" 
                [(ngModel)]="searchProjectsTerm"
                (input)="applyProjectsFilters()"
                class="block w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm" 
                placeholder="Search projects..."
            > 
        </div>
        <div class="flex items-center gap-3 w-full md:w-auto">
            <div class="relative">
                <button 
                    (click)="toggleProjectsFilter()"
                    class="flex items-center gap-1 bg-white hover:bg-gray-50 text-gray-700 py-2 px-3 rounded-lg border border-gray-300 text-sm"
                >
                    <fa-icon [icon]="faFilter"></fa-icon>
                    Filter
                </button>
                <div *ngIf="filterProjectsDropdown" class="filter-dropdown">
                    <div class="space-y-2">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Status</label>
                            <select 
                                [(ngModel)]="statusFilter"
                                (change)="applyProjectsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Statuses</option>
                                <option value="planning">Planning</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="on-hold">On Hold</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Priority</label>
                            <select 
                                [(ngModel)]="priorityFilter"
                                (change)="applyProjectsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Team</label>
                            <select 
                                [(ngModel)]="teamFilter"
                                (change)="applyProjectsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Teams</option>
                                <option *ngFor="let team of teams" [value]="team.name">{{team.name}}</option>
                            </select>
                        </div>
                        <div class="flex justify-end gap-1">
                            <button 
                                (click)="resetProjectsFilters()"
                                class="px-2 py-1 text-xs text-gray-600 hover:text-gray-800"
                            >
                                Reset
                            </button>
                            <button 
                                (click)="filterProjectsDropdown = false"
                                class="px-2 py-1 bg-indigo-600 text-white text-xs rounded-md hover:bg-indigo-700"
                            >
                                Apply
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button 
                (click)="showAddProjectModal = true"
                class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-3 rounded-lg flex items-center justify-center text-sm"
            >
                <fa-icon [icon]="faPlus" class="mr-2"></fa-icon> New Project
            </button>
        </div>
    </div>

    <!-- Projects Table -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-4">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deadline</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr *ngFor="let project of paginatedProjects" class="hover:bg-gray-50">
                        <td class="px-6 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="text-sm font-medium text-gray-900">{{project.name}}</div>
                            </div>
                        </td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">{{project.team}}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">{{formatDate(project.startDate)}}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">{{formatDate(project.deadline || '')}}</td>
                        <td class="px-6 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-20 mr-2">
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-indigo-600 h-1.5 rounded-full" [style.width]="project.progress + '%'"></div>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">{{project.progress}}%</span>
                            </div>
                        </td>
                        <td class="px-6 py-3 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-full text-xs" [ngClass]="getStatusClass(project.status)">
                                {{project.status.replace('-', ' ')}}
                            </span>
                        </td>
                        <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex justify-end space-x-1">
                                <button 
                                    (click)="viewProjectDetails(project.id)"
                                    class="action-btn view-btn" 
                                    title="View"
                                >
                                    <fa-icon [icon]="faEye"></fa-icon>
                                </button>
                                <button 
                                    (click)="editProject(project.id)"
                                    class="action-btn edit-btn" 
                                    title="Edit"
                                >
                                    <fa-icon [icon]="faEdit"></fa-icon>
                                </button>
                                <button 
                                    (click)="deleteProject(selectedProject)"
                                    class="action-btn delete-btn" 
                                    title="Delete"
                                >
                                    <fa-icon [icon]="faTrashAlt"></fa-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="filteredProjects.length === 0">
                        <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">
                            No projects found matching your criteria
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-between px-2 py-3">
        <div class="text-sm text-gray-500">
            Showing {{(currentPage - 1) * itemsPerPage + 1}} to {{getToEntryNumber()}} of {{filteredProjects.length}} entries
        </div>
        <div class="flex space-x-1" *ngIf="totalPages > 1">
            <button 
                (click)="changePage(currentPage - 1)"
                [disabled]="currentPage === 1"
                class="pagination-btn"
                [class.disabled]="currentPage === 1"
            >
                Previous
            </button>
            <button 
                *ngFor="let page of getPageNumbers()"
                (click)="changePage(page)"
                class="pagination-btn"
                [class.active]="currentPage === page"
            >
                {{page}}
            </button>
            <button 
                (click)="changePage(currentPage + 1)"
                [disabled]="currentPage === totalPages"
                class="pagination-btn"
                [class.disabled]="currentPage === totalPages"
            >
                Next
            </button>
        </div>
    </div>
</div>

<!-- Sprints Tab Content -->
<div *ngIf="activeTab === 'sprints'" class="tab-content">
    <!-- Search, Filter and Add Sprint -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4"> 
        <div class="relative w-full md:w-64">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <fa-icon [icon]="faSearch" class="text-gray-400 text-sm"></fa-icon>
            </div>
            <input 
                type="text" 
                [(ngModel)]="searchSprintsTerm"
                (input)="applySprintsFilters()"
                class="block w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm" 
                placeholder="Search sprints..."
            > 
        </div>
        <div class="flex items-center gap-3 w-full md:w-auto">
            <div class="relative">
                <button 
                    (click)="filterSprintsDropdown = !filterSprintsDropdown"
                    class="flex items-center gap-1 bg-white hover:bg-gray-50 text-gray-700 py-2 px-3 rounded-lg border border-gray-300 text-sm"
                >
                    <fa-icon [icon]="faFilter"></fa-icon>
                    Filter
                </button>
                <div *ngIf="filterSprintsDropdown" class="filter-dropdown">
                    <div class="space-y-2">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Status</label>
                            <select 
                                [(ngModel)]="sprintStatusFilter"
                                (change)="applySprintsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Project</label>
                            <select 
                                [(ngModel)]="sprintProjectFilter"
                                (change)="applySprintsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Projects</option>
                                <option *ngFor="let project of projects" [value]="project.name">{{project.name}}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Due Date</label>
                            <select 
                                [(ngModel)]="sprintDueDateFilter"
                                (change)="applySprintsFilters()"
                                class="block w-full px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            >
                                <option value="">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>
                        <div class="flex justify-end gap-1">
                            <button 
                                (click)="resetSprintsFilters()"
                                class="px-2 py-1 text-xs text-gray-600 hover:text-gray-800"
                            >
                                Reset
                            </button>
                            <button 
                                (click)="filterSprintsDropdown = false"
                                class="px-2 py-1 bg-indigo-600 text-white text-xs rounded-md hover:bg-indigo-700"
                            >
                                Apply
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button 
                (click)="showAddSprintModal = true"
                class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-3 rounded-lg flex items-center justify-center text-sm"
            >
                <fa-icon [icon]="faPlus" class="mr-2"></fa-icon> New Sprint
            </button>
        </div>
    </div>

    <!-- Sprints Cards -->
    <div class="space-y-4">
        <div *ngFor="let sprint of filteredSprints" class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-sm font-medium text-gray-900">{{sprint.name}}</h3>
                        <p class="text-xs text-gray-500 mt-1">{{sprint.project}}</p>
                    </div>
                    <span class="px-2 py-1 rounded-full text-xs" [ngClass]="{
                        'bg-green-100 text-green-800': sprint.status === 'completed',
                        'bg-blue-100 text-blue-800': sprint.status === 'active',
                        'bg-yellow-100 text-yellow-800': sprint.status === 'upcoming'
                    }">
                        {{sprint.status | titlecase}}
                    </span>
                </div>
                <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
                    <div>
                        <p class="text-gray-500">Start Date</p>
                        <p class="text-gray-900">{{formatDate(sprint.startDate)}}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">End Date</p>
                        <p class="text-gray-900">{{formatDate(sprint.endDate)}}</p>
                    </div>
                </div>
                <div class="mt-3">
                    <p class="text-xs text-gray-500">Sprint Goal</p>
                    <p class="text-xs text-gray-700 mt-1">{{sprint.goal}}</p>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-16 mr-2">
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div class="bg-indigo-600 h-1.5 rounded-full" [style.width]="sprint.stats?.progress + '%'"></div>
                            </div>
                        </div>
                        <span class="text-xs text-gray-500">{{sprint.stats?.tasksCompleted}}/{{sprint.stats?.totalTasks}} tasks</span>
                    </div>
                    <div class="flex space-x-2">
                        <button 
                            (click)="viewSprintDetails(sprint.id)"
                            class="text-xs text-indigo-600 hover:text-indigo-900"
                        >
                            View
                        </button>
                        <button 
                            (click)="editSprint(sprint.id)"
                            class="text-xs text-gray-600 hover:text-gray-900"
                        >
                            Edit
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="filteredSprints.length === 0" class="text-center text-sm text-gray-500 py-4">
            No sprints found matching your criteria
        </div>
    </div>
</div>

<!-- Add Project Modal -->
<div [class.open]="showAddProjectModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">Create New Project</h3>
                <button (click)="closeAllModals()" class="text-gray-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <form (ngSubmit)="createNewProject()" [formGroup]="projectForm" #addProjectForm="ngForm">
                <div class="space-y-4">
                    <div>
                        <label for="projectName" class="block text-xs font-medium text-gray-500 required-field">Project Name</label>
                        <input type="text" id="projectName" formControlName="name" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="projectForm.get('name')?.invalid && (projectForm.get('name')?.dirty || projectForm.get('name')?.touched)">
                        <div *ngIf="projectForm.get('name')?.invalid && (projectForm.get('name')?.dirty || projectForm.get('name')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="projectForm.get('name')?.errors?.['required']">Project name is required</span>
                            <span *ngIf="projectForm.get('name')?.errors?.['minlength']">Project name must be at least 3 characters</span>
                        </div>
                    </div>
                    <div>
                        <label for="projectDescription" class="block text-xs font-medium text-gray-500 required-field">Description</label>
                        <textarea id="projectDescription" rows="3" formControlName="description" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="projectForm.get('description')?.invalid && (projectForm.get('description')?.dirty || projectForm.get('description')?.touched)"></textarea>
                        <div *ngIf="projectForm.get('description')?.invalid && (projectForm.get('description')?.dirty || projectForm.get('description')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="projectForm.get('description')?.errors?.['required']">Description is required</span>
                            <span *ngIf="projectForm.get('description')?.errors?.['minlength']">Description must be at least 10 characters</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="projectStartDate" class="block text-xs font-medium text-gray-500 required-field">Start Date</label>
                            <input type="date" id="projectStartDate" formControlName="startDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="projectForm.get('startDate')?.invalid && (projectForm.get('startDate')?.dirty || projectForm.get('startDate')?.touched)">
                            <div *ngIf="projectForm.get('startDate')?.invalid && (projectForm.get('startDate')?.dirty || projectForm.get('startDate')?.touched)" class="text-xs text-red-500 mt-1">
                                Start date is required
                            </div>
                        </div>
                        <div>
                            <label for="projectEndDate" class="block text-xs font-medium text-gray-500 required-field">End Date</label>
                            <input type="date" id="projectEndDate" formControlName="endDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="projectForm.get('endDate')?.invalid && (projectForm.get('endDate')?.dirty || projectForm.get('endDate')?.touched)">
                            <div *ngIf="projectForm.get('endDate')?.invalid && (projectForm.get('endDate')?.dirty || projectForm.get('endDate')?.touched)" class="text-xs text-red-500 mt-1">
                                End date is required
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="projectTeam" class="block text-xs font-medium text-gray-500 required-field">Assigned Team</label>
                            <select id="projectTeam" formControlName="team" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="projectForm.get('team')?.invalid && (projectForm.get('team')?.dirty || projectForm.get('team')?.touched)">
                                <option value="">Select Team</option>
                                <option *ngFor="let team of teams" [value]="team.name">{{team.name}}</option>
                            </select>
                            <div *ngIf="projectForm.get('team')?.invalid && (projectForm.get('team')?.dirty || projectForm.get('team')?.touched)" class="text-xs text-red-500 mt-1">
                                Team is required
                            </div>
                        </div>
                        <div>
                            <label for="projectPriority" class="block text-xs font-medium text-gray-500">Priority</label>
                            <select id="projectPriority" formControlName="priority" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="projectManager" class="block text-xs font-medium text-gray-500 required-field">Project Manager</label>
                        <select id="projectManager" formControlName="manager" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="projectForm.get('manager')?.invalid && (projectForm.get('manager')?.dirty || projectForm.get('manager')?.touched)">
                            <option value="">Select Project Manager</option>
                            <option *ngFor="let user of users" [value]="user.name">{{user.name}}</option>
                        </select>
                        <div *ngIf="projectForm.get('manager')?.invalid && (projectForm.get('manager')?.dirty || projectForm.get('manager')?.touched)" class="text-xs text-red-500 mt-1">
                            Project manager is required
                        </div>
                    </div>
                    <div>
                        <label for="projectBudget" class="block text-xs font-medium text-gray-500">Budget ($)</label>
                        <input type="number" id="projectBudget" formControlName="budget" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="projectForm.get('budget')?.invalid && (projectForm.get('budget')?.dirty || projectForm.get('budget')?.touched)">
                        <div *ngIf="projectForm.get('budget')?.invalid && (projectForm.get('budget')?.dirty || projectForm.get('budget')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="projectForm.get('budget')?.errors?.['required']">Budget is required</span>
                            <span *ngIf="projectForm.get('budget')?.errors?.['min']">Budget must be positive</span>
                        </div>
                    </div>
                    <div>
                        <label for="projectFiles" class="block text-xs font-medium text-gray-500">Project Files</label>
                        <input type="file" id="projectFiles" (change)="onFileSelected($event)" multiple 
                            class="block w-full px-3 py-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                        <p class="mt-1 text-xs text-gray-500">Upload any relevant files for this project (PDF, DOC, XLS, etc.)</p>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" (click)="closeAllModals()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700"
                            [disabled]="projectForm.invalid">
                            Create Project
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Project Details Modal -->
<div [class.open]="showProjectDetailsModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">{{selectedProject?.name}}</h3>
                <button (click)="closeAllModals()" class="text-gray-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-2/3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Project ID</label>
                            <p class="text-sm mt-1 font-medium">{{selectedProject?.id}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Status</label>
                            <p class="text-sm mt-1" [ngClass]="{
                                'text-green-600': selectedProject?.status === 'completed',
                                'text-blue-600': selectedProject?.status === 'in-progress',
                                'text-yellow-600': selectedProject?.status === 'planning',
                                'text-gray-600': selectedProject?.status === 'on-hold'
                            }">
                                {{selectedProject?.status?.replace('-', ' ') | titlecase}}
                            </p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Start Date</label>
                            <p class="text-sm mt-1">{{formatDate(selectedProject?.startDate || '')}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Deadline</label>
                            <p class="text-sm mt-1">{{formatDate(selectedProject?.deadline || '')}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Project Manager</label>
                            <p class="text-sm mt-1">{{selectedProject?.manager}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Assigned Team</label>
                            <p class="text-sm mt-1">{{selectedProject?.team}}</p>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-xs font-medium text-gray-500">Description</label>
                        <p class="text-sm mt-1">{{selectedProject?.description}}</p>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <label class="block text-xs font-medium text-gray-500">Progress</label>
                            <span class="text-xs font-medium">{{selectedProject?.progress}}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                            <div class="bg-indigo-600 h-1.5 rounded-full" [style.width]="selectedProject?.progress + '%'"></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-xs font-medium text-gray-500 mb-1">Project Files</label>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <fa-icon [icon]="faFilePdf" class="text-red-500 text-sm mr-2"></fa-icon>
                                    <span class="text-xs">Project_Specifications.pdf</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="text-indigo-600 hover:text-indigo-800 text-xs">Download</button>
                                    <button class="text-red-600 hover:text-red-800 text-xs">Delete</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <fa-icon [icon]="faFileWord" class="text-blue-500 text-sm mr-2"></fa-icon>
                                    <span class="text-xs">Requirements_Document.docx</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="text-indigo-600 hover:text-indigo-800 text-xs">Download</button>
                                    <button class="text-red-600 hover:text-red-800 text-xs">Delete</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <label class="block text-xs font-medium text-gray-500 mb-1">Upload New Files</label>
                            <input type="file" class="block w-full px-3 py-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm" multiple>
                        </div>
                    </div>
                </div>
                <div class="w-full md:w-1/3">
                    <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <h4 class="text-sm font-medium text-gray-800 mb-3">Project Statistics</h4>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Tasks Completed</span>
                                    <span>{{selectedProject?.stats?.tasksCompleted}}/{{selectedProject?.stats?.totalTasks}}</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Time Spent</span>
                                    <span>{{selectedProject?.stats?.timeSpent}} / {{selectedProject?.stats?.estimatedTime}} hours</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Budget Used</span>
                                    <span>${{selectedProject?.stats?.budgetUsed}}/${{selectedProject?.stats?.totalBudget}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <h4 class="text-sm font-medium text-gray-800 mb-3">Team Members</h4>
                        <div class="space-y-2">
                            <div class="flex items-center" *ngFor="let member of teamMembers">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs">
                                    {{getInitials(member.name)}}
                                </div>
                                <div class="ml-2">
                                    <p class="text-xs font-medium text-gray-900">{{member.name}}</p>
                                    <p class="text-xs text-gray-500">{{member.role}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-sm font-medium text-gray-800">Sprints</h4>
                            <button class="text-xs text-indigo-600 hover:text-indigo-800">View All</button>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between text-xs" *ngFor="let sprint of selectedProject?.sprints">
                                <span>{{sprint}}</span>
                            </div>
                            <p class="text-xs text-gray-500" *ngIf="!selectedProject?.sprints?.length">No sprints yet</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button (click)="deleteProject(selectedProject)" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700">
                    Delete Project
                </button>
                <button (click)="editProject(selectedProject!.id)" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700">
                    Edit Project
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Project Modal -->
<div [class.open]="showEditProjectModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">Edit Project</h3>
                <button (click)="closeAllModals()" class="text-gray-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <form (ngSubmit)="updateProject()" [formGroup]="editProjectForm">
                <div class="space-y-4">
                    <div>
                        <label for="editProjectName" class="block text-xs font-medium text-gray-500 required-field">Project Name</label>
                        <input type="text" id="editProjectName" formControlName="name" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="editProjectForm.get('name')?.invalid && (editProjectForm.get('name')?.dirty || editProjectForm.get('name')?.touched)">
                        <div *ngIf="editProjectForm.get('name')?.invalid && (editProjectForm.get('name')?.dirty || editProjectForm.get('name')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="editProjectForm.get('name')?.errors?.['required']">Project name is required</span>
                            <span *ngIf="editProjectForm.get('name')?.errors?.['minlength']">Project name must be at least 3 characters</span>
                        </div>
                    </div>
                    <div>
                        <label for="editProjectDescription" class="block text-xs font-medium text-gray-500 required-field">Description</label>
                        <textarea id="editProjectDescription" rows="3" formControlName="description" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="editProjectForm.get('description')?.invalid && (editProjectForm.get('description')?.dirty || editProjectForm.get('description')?.touched)"></textarea>
                        <div *ngIf="editProjectForm.get('description')?.invalid && (editProjectForm.get('description')?.dirty || editProjectForm.get('description')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="editProjectForm.get('description')?.errors?.['required']">Description is required</span>
                            <span *ngIf="editProjectForm.get('description')?.errors?.['minlength']">Description must be at least 10 characters</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="editProjectStartDate" class="block text-xs font-medium text-gray-500 required-field">Start Date</label>
                            <input type="date" id="editProjectStartDate" formControlName="startDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editProjectForm.get('startDate')?.invalid && (editProjectForm.get('startDate')?.dirty || editProjectForm.get('startDate')?.touched)">
                            <div *ngIf="editProjectForm.get('startDate')?.invalid && (editProjectForm.get('startDate')?.dirty || editProjectForm.get('startDate')?.touched)" class="text-xs text-red-500 mt-1">
                                Start date is required
                            </div>
                        </div>
                        <div>
                            <label for="editProjectEndDate" class="block text-xs font-medium text-gray-500 required-field">End Date</label>
                            <input type="date" id="editProjectEndDate" formControlName="deadline" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editProjectForm.get('deadline')?.invalid && (editProjectForm.get('deadline')?.dirty || editProjectForm.get('deadline')?.touched)">
                            <div *ngIf="editProjectForm.get('deadline')?.invalid && (editProjectForm.get('deadline')?.dirty || editProjectForm.get('deadline')?.touched)" class="text-xs text-red-500 mt-1">
                                End date is required
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="editProjectTeam" class="block text-xs font-medium text-gray-500 required-field">Assigned Team</label>
                            <select id="editProjectTeam" formControlName="team" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editProjectForm.get('team')?.invalid && (editProjectForm.get('team')?.dirty || editProjectForm.get('team')?.touched)">
                                <option value="">Select Team</option>
                                <option *ngFor="let team of teams" [value]="team.name">{{team.name}}</option>
                            </select>
                            <div *ngIf="editProjectForm.get('team')?.invalid && (editProjectForm.get('team')?.dirty || editProjectForm.get('team')?.touched)" class="text-xs text-red-500 mt-1">
                                Team is required
                            </div>
                        </div>
                        <div>
                            <label for="editProjectStatus" class="block text-xs font-medium text-gray-500">Status</label>
                            <select id="editProjectStatus" formControlName="status" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="planning">Planning</option>
                                <option value="in-progress">In Progress</option>
                                <option value="on-hold">On Hold</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="editProjectPriority" class="block text-xs font-medium text-gray-500">Priority</label>
                            <select id="editProjectPriority" formControlName="priority" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div>
                            <label for="editProjectProgress" class="block text-xs font-medium text-gray-500">Progress (%)</label>
                            <input type="number" id="editProjectProgress" formControlName="progress" min="0" max="100"
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editProjectForm.get('progress')?.invalid && (editProjectForm.get('progress')?.dirty || editProjectForm.get('progress')?.touched)">
                            <div *ngIf="editProjectForm.get('progress')?.invalid && (editProjectForm.get('progress')?.dirty || editProjectForm.get('progress')?.touched)" class="text-xs text-red-500 mt-1">
                                Progress must be between 0 and 100
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="editProjectManager" class="block text-xs font-medium text-gray-500 required-field">Project Manager</label>
                        <select id="editProjectManager" formControlName="manager" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="editProjectForm.get('manager')?.invalid && (editProjectForm.get('manager')?.dirty || editProjectForm.get('manager')?.touched)">
                            <option value="">Select Project Manager</option>
                            <option *ngFor="let user of users" [value]="user.name">{{user.name}}</option>
                        </select>
                        <div *ngIf="editProjectForm.get('manager')?.invalid && (editProjectForm.get('manager')?.dirty || editProjectForm.get('manager')?.touched)" class="text-xs text-red-500 mt-1">
                            Project manager is required
                        </div>
                    </div>
                    <div>
                        <label for="editProjectBudget" class="block text-xs font-medium text-gray-500">Budget ($)</label>
                        <input type="number" id="editProjectBudget" formControlName="budget" min="0"
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="editProjectForm.get('budget')?.invalid && (editProjectForm.get('budget')?.dirty || editProjectForm.get('budget')?.touched)">
                        <div *ngIf="editProjectForm.get('budget')?.invalid && (editProjectForm.get('budget')?.dirty || editProjectForm.get('budget')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="editProjectForm.get('budget')?.errors?.['required']">Budget is required</span>
                            <span *ngIf="editProjectForm.get('budget')?.errors?.['min']">Budget must be positive</span>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" (click)="closeAllModals()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700"
                            [disabled]="editProjectForm.invalid">
                            Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Sprint Modal -->
<div [class.open]="showAddSprintModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">Create New Sprint</h3>
                <button (click)="closeAllModals()" class="text-gray-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <form (ngSubmit)="createNewSprint()" [formGroup]="sprintForm" #addSprintForm="ngForm">
                <div class="space-y-4">
                    <div>
                        <label for="sprintName" class="block text-xs font-medium text-gray-500 required-field">Sprint Name</label>
                        <input type="text" id="sprintName" formControlName="name" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="sprintForm.get('name')?.invalid && (sprintForm.get('name')?.dirty || sprintForm.get('name')?.touched)">
                        <div *ngIf="sprintForm.get('name')?.invalid && (sprintForm.get('name')?.dirty || sprintForm.get('name')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="sprintForm.get('name')?.errors?.['required']">Sprint name is required</span>
                            <span *ngIf="sprintForm.get('name')?.errors?.['minlength']">Sprint name must be at least 3 characters</span>
                        </div>
                    </div>
                    <div>
                        <label for="sprintDescription" class="block text-xs font-medium text-gray-500">Description (Optional)</label>
                        <textarea id="sprintDescription" rows="3" formControlName="description" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="sprintProject" class="block text-xs font-medium text-gray-500 required-field">Project</label>
                            <select id="sprintProject" formControlName="project" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="sprintForm.get('project')?.invalid && (sprintForm.get('project')?.dirty || sprintForm.get('project')?.touched)">
                                <option value="">Select Project</option>
                                <option *ngFor="let project of projects" [value]="project.name">{{project.name}}</option>
                            </select>
                            <div *ngIf="sprintForm.get('project')?.invalid && (sprintForm.get('project')?.dirty || sprintForm.get('project')?.touched)" class="text-xs text-red-500 mt-1">
                                Project is required
                            </div>
                        </div>
                        <div>
                            <label for="sprintStatus" class="block text-xs font-medium text-gray-500">Status</label>
                            <select id="sprintStatus" formControlName="status" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="upcoming">Upcoming</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="sprintStartDate" class="block text-xs font-medium text-gray-500 required-field">Start Date</label>
                            <input type="date" id="sprintStartDate" formControlName="startDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="sprintForm.get('startDate')?.invalid && (sprintForm.get('startDate')?.dirty || sprintForm.get('startDate')?.touched)">
                            <div *ngIf="sprintForm.get('startDate')?.invalid && (sprintForm.get('startDate')?.dirty || sprintForm.get('startDate')?.touched)" class="text-xs text-red-500 mt-1">
                                Start date is required
                            </div>
                        </div>
                        <div>
                            <label for="sprintEndDate" class="block text-xs font-medium text-gray-500 required-field">End Date</label>
                            <input type="date" id="sprintEndDate" formControlName="endDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="sprintForm.get('endDate')?.invalid && (sprintForm.get('endDate')?.dirty || sprintForm.get('endDate')?.touched)">
                            <div *ngIf="sprintForm.get('endDate')?.invalid && (sprintForm.get('endDate')?.dirty || sprintForm.get('endDate')?.touched)" class="text-xs text-red-500 mt-1">
                                End date is required
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="sprintGoal" class="block text-xs font-medium text-gray-500">Sprint Goal</label>
                        <textarea id="sprintGoal" rows="2" formControlName="goal" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"></textarea>
                    </div>
                    <div>
                        <label for="sprintTasks" class="block text-xs font-medium text-gray-500">Add Tasks (Optional)</label>
                        <select id="sprintTasks" multiple formControlName="selectedTasks"
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                            <option value="Design Homepage">Design Homepage</option>
                            <option value="Develop Frontend">Develop Frontend</option>
                            <option value="API Integration">API Integration</option>
                            <option value="Content Migration">Content Migration</option>
                            <option value="UI Design">UI Design</option>
                            <option value="Backend Setup">Backend Setup</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Hold Ctrl/Cmd to select multiple tasks</p>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" (click)="closeAllModals()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700"
                            [disabled]="sprintForm.invalid">
                            Create Sprint
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Sprint Details Modal -->
<div [class.open]="showSprintDetailsModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">{{selectedSprint?.name}}</h3>
                <button (click)="closeAllModals()" class="text-gray-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-2/3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Project</label>
                            <p class="text-sm mt-1 font-medium">{{selectedSprint?.project}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Status</label>
                            <p class="text-sm mt-1" [ngClass]="{
                                'text-green-600': selectedSprint?.status === 'completed',
                                'text-blue-600': selectedSprint?.status === 'active',
                                'text-yellow-600': selectedSprint?.status === 'upcoming'
                            }">
                                {{selectedSprint?.status | titlecase}}
                            </p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">Start Date</label>
                            <p class="text-sm mt-1">{{formatDate(selectedSprint?.startDate || '')}}</p>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500">End Date</label>
                            <p class="text-sm mt-1">{{formatDate(selectedSprint?.endDate || '')}}</p>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-xs font-medium text-gray-500">Sprint Goal</label>
                        <p class="text-sm mt-1">{{selectedSprint?.goal}}</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-xs font-medium text-gray-500">Description</label>
                        <p class="text-sm mt-1">{{selectedSprint?.description || 'No description provided'}}</p>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-sm font-medium text-gray-800">Tasks</h4>
                            <button class="text-xs text-indigo-600 hover:text-indigo-800">Add Task</button>
                        </div>
                        <div class="space-y-2">
                            <div class="bg-gray-50 p-3 rounded-lg" *ngFor="let task of selectedSprint?.tasks">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="text-xs font-medium text-gray-900">{{task.name}}</h4>
                                        <p class="text-xs text-gray-500 mt-1">Assigned to: {{task.assignee}}</p>
                                    </div>
                                    <span class="text-xs px-2 py-1 rounded-full" 
                                        [ngClass]="{
                                            'bg-green-100 text-green-800': task.status === 'done',
                                            'bg-blue-100 text-blue-800': task.status === 'in-progress',
                                            'bg-gray-100 text-gray-800': task.status === 'todo'
                                        }">
                                        {{task.status.replace('-', ' ') | titlecase}}
                                    </span>
                                </div>
                                <div class="mt-2 grid grid-cols-2 gap-2 text-xs">
                                    <div>
                                        <p class="text-gray-500">Due Date</p>
                                        <p class="text-gray-900">{{formatDate(task.dueDate)}}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Priority</p>
                                        <p class="text-gray-900">{{task.priority | titlecase}}</p>
                                    </div>
                                </div>
                                <div class="mt-2 flex justify-between items-center">
                                    <div class="flex items-center">
                                        <div class="w-16 mr-2">
                                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                <div class="bg-indigo-600 h-1.5 rounded-full" 
                                                    [style.width]="task.status === 'done' ? '100%' : task.status === 'in-progress' ? '50%' : '0%'"></div>
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-500">{{task.estimatedHours}}h</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="text-xs text-indigo-600 hover:text-indigo-800">Edit</button>
                                        <button class="text-xs text-red-600 hover:text-red-800">Delete</button>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500" *ngIf="!selectedSprint?.tasks?.length">No tasks yet</p>
                        </div>
                    </div>
                </div>
                <div class="w-full md:w-1/3">
                    <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <h4 class="text-sm font-medium text-gray-800 mb-3">Sprint Statistics</h4>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Tasks Completed</span>
                                    <span>{{selectedSprint?.stats?.tasksCompleted}}/{{selectedSprint?.stats?.totalTasks}}</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Time Spent</span>
                                    <span>{{selectedSprint?.stats?.timeSpent}} / {{selectedSprint?.stats?.estimatedTime}} hours</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Days Remaining</span>
                                    <span>{{calculateDaysRemaining(selectedSprint?.endDate || '') > 0 ? calculateDaysRemaining(selectedSprint?.endDate || '') + ' days' : 'Completed'}}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-purple-500 h-1.5 rounded-full" 
                                        [style.width]="calculateSprintProgress(selectedSprint) + '%'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <h4 class="text-sm font-medium text-gray-800 mb-3">Team Members</h4>
                        <div class="space-y-2">
                            <div class="flex items-center" *ngFor="let member of teamMembers">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs">
                                    {{getInitials(member.name)}}
                                </div>
                                <div class="ml-2">
                                    <p class="text-xs font-medium text-gray-900">{{member.name}}</p>
                                    <p class="text-xs text-gray-500">{{member.role}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button (click)="deleteSprint(selectedSprint)" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700">
                    Delete Sprint
                </button>
                <button (click)="editSprint(selectedSprint?.id || '')" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700">
                    Edit Sprint
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Sprint Modal -->
<div [class.open]="showEditSprintModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-gray-800">Edit Sprint</h3>
                <button (click)="closeAllModals()" class="text-red-400 hover:text-gray-600 text-base">
                    <fa-icon [icon]="faTimes"></fa-icon>
                </button>
            </div>
            <form (ngSubmit)="updateSprint()" [formGroup]="editSprintForm">
                <div class="space-y-4">
                    <div>
                        <label for="editSprintName" class="block text-xs font-medium text-gray-500 required-field">Sprint Name</label>
                        <input type="text" id="editSprintName" formControlName="name" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                            [class.border-red-300]="editSprintForm.get('name')?.invalid && (editSprintForm.get('name')?.dirty || editSprintForm.get('name')?.touched)">
                        <div *ngIf="editSprintForm.get('name')?.invalid && (editSprintForm.get('name')?.dirty || editSprintForm.get('name')?.touched)" class="text-xs text-red-500 mt-1">
                            <span *ngIf="editSprintForm.get('name')?.errors?.['required']">Sprint name is required</span>
                            <span *ngIf="editSprintForm.get('name')?.errors?.['minlength']">Sprint name must be at least 3 characters</span>
                        </div>
                    </div>
                    <div>
                        <label for="editSprintDescription" class="block text-xs font-medium text-gray-500">Description (Optional)</label>
                        <textarea id="editSprintDescription" rows="3" formControlName="description" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="editSprintProject" class="block text-xs font-medium text-gray-500 required-field">Project</label>
                            <select id="editSprintProject" formControlName="project" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editSprintForm.get('project')?.invalid && (editSprintForm.get('project')?.dirty || editSprintForm.get('project')?.touched)">
                                <option value="">Select Project</option>
                                <option *ngFor="let project of projects" [value]="project.name">{{project.name}}</option>
                            </select>
                            <div *ngIf="editSprintForm.get('project')?.invalid && (editSprintForm.get('project')?.dirty || editSprintForm.get('project')?.touched)" class="text-xs text-red-500 mt-1">
                                Project is required
                            </div>
                        </div>
                        <div>
                            <label for="editSprintStatus" class="block text-xs font-medium text-gray-500">Status</label>
                            <select id="editSprintStatus" formControlName="status" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="upcoming">Upcoming</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="editSprintStartDate" class="block text-xs font-medium text-gray-500 required-field">Start Date</label>
                            <input type="date" id="editSprintStartDate" formControlName="startDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editSprintForm.get('startDate')?.invalid && (editSprintForm.get('startDate')?.dirty || editSprintForm.get('startDate')?.touched)">
                            <div *ngIf="editSprintForm.get('startDate')?.invalid && (editSprintForm.get('startDate')?.dirty || editSprintForm.get('startDate')?.touched)" class="text-xs text-red-500 mt-1">
                                Start date is required
                            </div>
                        </div>
                        <div>
                            <label for="editSprintEndDate" class="block text-xs font-medium text-gray-500 required-field">End Date</label>
                            <input type="date" id="editSprintEndDate" formControlName="endDate" 
                                class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                [class.border-red-300]="editSprintForm.get('endDate')?.invalid && (editSprintForm.get('endDate')?.dirty || editSprintForm.get('endDate')?.touched)">
                            <div *ngIf="editSprintForm.get('endDate')?.invalid && (editSprintForm.get('endDate')?.dirty || editSprintForm.get('endDate')?.touched)" class="text-xs text-red-500 mt-1">
                                End date is required
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="editSprintGoal" class="block text-xs font-medium text-gray-500">Sprint Goal</label>
                        <textarea id="editSprintGoal" rows="2" formControlName="goal" 
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"></textarea>
                    </div>
                    <div>
                        <label for="editSprintTasks" class="block text-xs font-medium text-gray-500">Tasks</label>
                        <select id="editSprintTasks" multiple formControlName="selectedTasks"
                            class="block w-full px-3 py-1 mt-1 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                            <option value="Design Homepage">Design Homepage</option>
                            <option value="Develop Frontend">Develop Frontend</option>
                            <option value="API Integration">API Integration</option>
                            <option value="Content Migration">Content Migration</option>
                            <option value="UI Design">UI Design</option>
                            <option value="Backend Setup">Backend Setup</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Hold Ctrl/Cmd to select multiple tasks</p>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" (click)="closeAllModals()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700"
                            [disabled]="editSprintForm.invalid">
                            Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>